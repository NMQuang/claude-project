# Deployment & Rollback Plan (COBOL → Java)

## Document Information

| Item | Details |
|------|---------|
| **Project Name** | {{project.name}} |
| **Migration Type** | COBOL → Java |
| **Document Type** | Deployment & Rollback Plan |
| **Generated Date** | {{generated_date}} |
| **Version** | {{version}} |

---

## 1. Deployment Scope from Source Analysis

### 1.1 Components to Deploy

**Source:** COBOL program and artifact inventory

| Component Type | Count | Java Equivalent | Deployment Target | Source |
|----------------|-------|-----------------|-------------------|--------|
| COBOL Programs | {{metadata.source_analysis.total_files}} | Java Services/Classes | Application Server | Program scan |
| Copybooks | {{metadata.copybook_count}} | DTO/Entity Classes | Application Server | COPY extraction |
| JCL Jobs | {{metadata.jcl_count}} | Spring Batch Jobs | Batch Server | JCL scan |
| DB2 Tables | {{metadata.db2_table_count}} | Database Schema | {{target.database}} | EXEC SQL extraction |
| CICS Transactions | {{metadata.cics_count}} | REST APIs/Controllers | Application Server | EXEC CICS extraction |

### 1.2 Deployment Artifacts from Source

**Source:** Migration design output

{{#if deployment.artifacts}}
| Artifact | Source Origin | Description | Target Location | Source |
|----------|---------------|-------------|-----------------|--------|
{{#each deployment.artifacts}}
| {{this.artifact}} | {{this.origin}} | {{this.description}} | {{this.location}} | `{{this.source}}` |
{{/each}}
{{else}}
| Artifact | Source Origin | Description |
|----------|---------------|-------------|
| Application JAR | COBOL Programs | Migrated Java services |
| Database DDL | EXEC SQL/DCLGEN | Schema migration scripts |
| Batch Jobs | JCL Jobs | Spring Batch configurations |
| Configuration | JCL PARM/SYSIN | application.yml, batch configs |

> Artifact list derived from source inventory.
{{/if}}

---

## 2. Pre-Deployment Checklist

### 2.1 Source Migration Verification

**Source:** Migration completion status

{{#if deployment.pre_checks.migration}}
| Check | Component | Status | Source Evidence |
|-------|-----------|--------|-----------------|
{{#each deployment.pre_checks.migration}}
| {{this.check}} | {{this.component}} | {{this.status}} | `{{this.source}}` |
{{/each}}
{{else}}
| Check | Count | Status | Source |
|-------|-------|--------|--------|
| Programs Migrated | {{metadata.source_analysis.total_files}} | [ ] Verified | Program inventory |
| Copybooks Converted | {{metadata.copybook_count}} | [ ] Verified | COPY extraction |
| JCL Jobs Converted | {{metadata.jcl_count}} | [ ] Verified | JCL scan |
| SQL Migrated | {{metadata.sql_count}} | [ ] Verified | EXEC SQL extraction |
| CICS Transactions | {{metadata.cics_count}} | [ ] Verified | EXEC CICS extraction |
{{/if}}

### 2.2 Testing Sign-Off from Source

**Source:** Test strategy completion

{{#if deployment.pre_checks.testing}}
| Test Type | Programs | Pass Rate | Sign-Off | Source |
|-----------|----------|-----------|----------|--------|
{{#each deployment.pre_checks.testing}}
| {{this.type}} | {{this.programs}} | {{this.pass_rate}} | {{this.signoff}} | `{{this.source}}` |
{{/each}}
{{else}}
| Test Type | Target | Status | Source |
|-----------|--------|--------|--------|
| Unit Tests | All {{metadata.source_analysis.total_files}} programs | [ ] Passed | Program scan |
| Integration Tests | All call chains | [ ] Passed | CALL extraction |
| Migration Tests | Data validation | [ ] Passed | Database inventory |
| UAT | Business functions | [ ] Signed off | Business rules |
{{/if}}

### 2.3 Environment Readiness

**Source:** Target architecture requirements

{{#if deployment.pre_checks.environment}}
| Component | Requirement | Status | Source |
|-----------|-------------|--------|--------|
{{#each deployment.pre_checks.environment}}
| {{this.component}} | {{this.requirement}} | {{this.status}} | `{{this.source}}` |
{{/each}}
{{else}}
| Component | Requirement | Status |
|-----------|-------------|--------|
| Application Server | Java {{target.java_version}} runtime | [ ] Ready |
| Database | {{target.database}} instance | [ ] Ready |
| Batch Server | Spring Batch infrastructure | [ ] Ready |
| File Storage | Migrated file locations | [ ] Ready |
| Network | Connectivity configured | [ ] Ready |
{{/if}}

---

## 3. Database Deployment

### 3.1 Schema Migration from Source

**Source:** EXEC SQL and DCLGEN extraction

{{#if deployment.database.schema}}
{{#each deployment.database.schema}}
#### Table: {{this.table}}

**Source:** `{{this.source_path}}`

**DDL Script:**
```sql
{{{this.ddl}}}
```

**Migration Order:** {{this.order}}

**Dependencies:** {{this.dependencies}}

---

{{/each}}
{{else}}
| Table | Columns | Source DCLGEN | Migration Script | Order |
|-------|---------|---------------|------------------|-------|
{{#if metadata.db2_tables}}
{{#each metadata.db2_tables}}
| {{this.name}} | {{this.columns}} | `{{this.source}}` | `{{this.script}}` | {{this.order}} |
{{/each}}
{{else}}
> **Not found in source:** Database schema requires EXEC SQL analysis.
{{/if}}
{{/if}}

### 3.2 Data Migration from Source

**Source:** Database content analysis

{{#if deployment.database.data}}
| Table | Rows | Migration Method | Validation | Source |
|-------|------|------------------|------------|--------|
{{#each deployment.database.data}}
| {{this.table}} | {{this.rows}} | {{this.method}} | {{this.validation}} | `{{this.source}}` |
{{/each}}
{{else}}
> **Not found in source:** Data migration plan requires production data analysis.
{{/if}}

### 3.3 Database Migration Scripts

**Source:** Generated from COBOL analysis

{{#if deployment.database.scripts}}
**Migration Script Sequence:**

```bash
{{#each deployment.database.scripts}}
# Step {{@index}}: {{this.description}}
# Source: {{this.source}}
{{this.command}}

{{/each}}
```
{{else}}
```bash
# 1. Create schema
psql -h $DB_HOST -U $DB_USER -d $DB_NAME -f schema/create_tables.sql

# 2. Create indexes (from DB2 analysis)
psql -h $DB_HOST -U $DB_USER -d $DB_NAME -f schema/create_indexes.sql

# 3. Migrate data
./migrate_data.sh --source-db $SOURCE --target-db $TARGET

# 4. Validate migration
psql -h $DB_HOST -U $DB_USER -d $DB_NAME -f validation/row_counts.sql
```

> Database scripts derived from EXEC SQL extraction.
{{/if}}

---

## 4. Application Deployment

### 4.1 Deployment Order from Dependencies

**Source:** CALL and COPY dependency analysis

{{#if deployment.application.order}}
| Phase | Components | Dependencies | Rationale | Source |
|-------|------------|--------------|-----------|--------|
{{#each deployment.application.order}}
| {{this.phase}} | {{this.components}} | {{this.dependencies}} | {{this.rationale}} | `{{this.source}}` |
{{/each}}
{{else}}
| Phase | Components | Source |
|-------|------------|--------|
| 1 | Common utilities, DTOs | Copybooks (no dependencies) |
| 2 | Data access layer | EXEC SQL programs |
| 3 | Business services | Core COBOL programs |
| 4 | Batch jobs | JCL-called programs |
| 5 | Online services | CICS programs |

> Deployment order derived from dependency analysis.
{{/if}}

### 4.2 Application Deployment Steps

**Source:** Target architecture design

{{#if deployment.application.steps}}
{{#each deployment.application.steps}}
#### Step {{@index}}: {{this.name}}

**Source Components:** {{this.components}}

**Source Evidence:** `{{this.source}}`

```bash
{{{this.commands}}}
```

**Verification:**
```bash
{{{this.verification}}}
```

---

{{/each}}
{{else}}
```bash
# Step 1: Deploy application artifact
# Source: Migrated from {{metadata.source_analysis.total_files}} COBOL programs
scp target/{{project.artifact_id}}-{{project.version}}.jar $APP_SERVER:/opt/app/

# Step 2: Deploy configuration
# Source: Extracted from JCL PARM and SYSIN
scp config/application-prod.yml $APP_SERVER:/opt/app/config/

# Step 3: Start application
ssh $APP_SERVER "systemctl start {{project.service_name}}"

# Step 4: Verify deployment
curl -f http://$APP_SERVER:8080/actuator/health
```

> Deployment steps derived from migration design.
{{/if}}

### 4.3 Batch Job Deployment

**Source:** JCL job analysis

{{#if deployment.batch.jobs}}
{{#each deployment.batch.jobs}}
#### Job: {{this.name}}

**Source JCL:** `{{this.source_jcl}}`

**Spring Batch Job:** `{{this.spring_job}}`

**Deployment:**
```bash
{{{this.deployment}}}
```

**Schedule:** {{this.schedule}}

---

{{/each}}
{{else}}
| Batch Job | Source JCL | Spring Batch Job | Schedule | Source |
|-----------|------------|------------------|----------|--------|
{{#if metadata.jcl_jobs}}
{{#each metadata.jcl_jobs}}
| {{this.name}} | `{{this.path}}` | {{this.spring_job}} | {{this.schedule}} | JCL scan |
{{/each}}
{{else}}
> **Not found in source:** Batch job deployment requires JCL analysis.
{{/if}}
{{/if}}

---

## 5. Validation Procedures

### 5.1 Component Validation from Source

**Source:** Migration inventory

{{#if deployment.validation.components}}
| Component | Source Program | Validation | Expected | Source |
|-----------|----------------|------------|----------|--------|
{{#each deployment.validation.components}}
| {{this.component}} | {{this.program}} | {{this.validation}} | {{this.expected}} | `{{this.source}}` |
{{/each}}
{{else}}
| Validation | Count | Method | Source |
|------------|-------|--------|--------|
| Services Deployed | {{metadata.source_analysis.total_files}} | Health check | Program scan |
| DTOs Created | {{metadata.copybook_count}} | Class loading | Copybook extraction |
| Batch Jobs Registered | {{metadata.jcl_count}} | Job listing | JCL scan |
| Database Tables | {{metadata.db2_table_count}} | Schema query | EXEC SQL |
{{/if}}

### 5.2 Functional Validation

**Source:** Business function inventory

{{#if deployment.validation.functional}}
{{#each deployment.validation.functional}}
#### Function: {{this.name}}

**Source Program:** `{{this.program}}`

**Validation Steps:**
{{#each this.steps}}
{{@index}}. {{this}}
{{/each}}

**Expected Result:** {{this.expected}}

---

{{/each}}
{{else}}
> **Not found in source:** Functional validation requires business function extraction.
{{/if}}

### 5.3 Data Validation Queries

**Source:** Database migration analysis

{{#if deployment.validation.data}}
{{#each deployment.validation.data}}
#### {{this.name}}

**Source Table:** `{{this.source_table}}`

```sql
{{{this.query}}}
```

**Expected:** {{this.expected}}

---

{{/each}}
{{else}}
```sql
-- Row count validation (from source inventory)
SELECT table_name,
       (SELECT COUNT(*) FROM source_table) as source_count,
       (SELECT COUNT(*) FROM target_table) as target_count
FROM migration_tables;

-- Checksum validation
SELECT MD5(string_agg(key_column::text, ',' ORDER BY key_column))
FROM migrated_table;
```

> Data validation queries derived from database inventory.
{{/if}}

---

## 6. Rollback Plan

### 6.1 Rollback Triggers

**Source:** Risk assessment from migration analysis

{{#if deployment.rollback.triggers}}
| Trigger | Threshold | Detection | Source Evidence |
|---------|-----------|-----------|-----------------|
{{#each deployment.rollback.triggers}}
| {{this.trigger}} | {{this.threshold}} | {{this.detection}} | `{{this.source}}` |
{{/each}}
{{else}}
| Trigger | Threshold | Detection |
|---------|-----------|-----------|
| Critical function failure | Any of {{metadata.source_analysis.total_files}} services | Health check |
| Data integrity error | Any discrepancy | Validation queries |
| Performance degradation | >50% baseline | Monitoring |
| Batch job failure | Critical jobs | Job status |
{{/if}}

### 6.2 Rollback Decision Matrix

**Source:** Component criticality analysis

{{#if deployment.rollback.matrix}}
| Component | Impact | Rollback Type | Time | Source |
|-----------|--------|---------------|------|--------|
{{#each deployment.rollback.matrix}}
| {{this.component}} | {{this.impact}} | {{this.type}} | {{this.time}} | `{{this.source}}` |
{{/each}}
{{else}}
| Component | Rollback Approach | Estimated Time |
|-----------|-------------------|----------------|
| Application | Blue-green switch | 5 minutes |
| Database Schema | DDL rollback scripts | 15-30 minutes |
| Database Data | Restore from backup | 30-60 minutes |
| Batch Jobs | Disable new, enable old | 10 minutes |
{{/if}}

### 6.3 Application Rollback Procedure

**Source:** Deployment architecture

{{#if deployment.rollback.application}}
```bash
{{{deployment.rollback.application}}}
```
{{else}}
```bash
# Step 1: Switch traffic to old version (Blue-Green)
./switch_traffic.sh --from green --to blue

# Step 2: Verify old system
curl -f http://$OLD_SERVER:8080/actuator/health

# Step 3: Stop new application
ssh $NEW_SERVER "systemctl stop {{project.service_name}}"

# Step 4: Monitor for stability
tail -f /var/log/app/application.log
```

> Application rollback based on deployment architecture.
{{/if}}

### 6.4 Database Rollback Procedure

**Source:** Database migration design

{{#if deployment.rollback.database}}
```bash
{{{deployment.rollback.database}}}
```
{{else}}
```bash
# Option 1: Schema-only rollback (if no data changes)
psql -h $DB_HOST -U $DB_USER -d $DB_NAME -f rollback/drop_new_objects.sql
psql -h $DB_HOST -U $DB_USER -d $DB_NAME -f rollback/restore_old_objects.sql

# Option 2: Full database restore (if data changes)
# WARNING: Data loss for transactions after backup
pg_restore -h $DB_HOST -U $DB_USER -d $DB_NAME /backups/pre_migration_backup.dump

# Validation after rollback
psql -h $DB_HOST -U $DB_USER -d $DB_NAME -f validation/verify_rollback.sql
```

> Database rollback derived from schema migration design.
{{/if}}

### 6.5 Batch Job Rollback

**Source:** JCL job inventory

{{#if deployment.rollback.batch}}
{{#each deployment.rollback.batch}}
#### Job: {{this.name}}

**Source JCL:** `{{this.source}}`

**Rollback:**
```bash
{{{this.rollback}}}
```

---

{{/each}}
{{else}}
```bash
# Disable new batch jobs
./batch-admin.sh --disable-all --tag=new-migration

# Re-enable old JCL jobs (if parallel running)
# Note: Requires mainframe access or emulation

# Verify batch schedule
./batch-admin.sh --list-scheduled
```

> Batch rollback based on JCL job inventory.
{{/if}}

---

## 7. Monitoring and Hypercare

### 7.1 Monitoring Targets from Source

**Source:** Component inventory and complexity analysis

{{#if deployment.monitoring.targets}}
| Target | Source Component | Metric | Threshold | Source |
|--------|------------------|--------|-----------|--------|
{{#each deployment.monitoring.targets}}
| {{this.target}} | {{this.component}} | {{this.metric}} | {{this.threshold}} | `{{this.source}}` |
{{/each}}
{{else}}
| Target | Count | Metric | Threshold |
|--------|-------|--------|-----------|
| Services | {{metadata.source_analysis.total_files}} | Health, Response Time | <2s |
| Database | {{metadata.db2_table_count}} tables | Query Time, Connections | <100ms |
| Batch Jobs | {{metadata.jcl_count}} | Duration, Status | ≤Baseline |
| Error Rate | All | Errors/minute | <1% |
{{/if}}

### 7.2 Critical Programs for Monitoring

**Source:** Complexity analysis

{{#if deployment.monitoring.critical}}
| Program | Complexity | Risk Level | Monitoring Priority | Source |
|---------|------------|------------|---------------------|--------|
{{#each deployment.monitoring.critical}}
| {{this.program}} | {{this.complexity}} | {{this.risk}} | {{this.priority}} | `{{this.source}}` |
{{/each}}
{{else}}
> High complexity programs (>15) require enhanced monitoring.

{{#if metadata.complexity.high_programs}}
| Program | Complexity | Source |
|---------|------------|--------|
{{#each metadata.complexity.high_programs}}
| {{this.name}} | {{this.score}} | `{{this.path}}` |
{{/each}}
{{else}}
> **Not found in source:** High complexity programs require analysis.
{{/if}}
{{/if}}

### 7.3 Hypercare Schedule

**Source:** Migration scope and risk

| Period | Focus | Escalation | Source |
|--------|-------|------------|--------|
| 0-24 hours | All {{metadata.source_analysis.total_files}} services | Immediate | Migration scope |
| Day 2-7 | Critical business functions | 1 hour | Business priority |
| Week 2-4 | Batch processing, edge cases | 4 hours | JCL analysis |

---

## 8. Communication Plan

### 8.1 Stakeholder Notification

**Source:** Migration impact analysis

{{#if deployment.communication.stakeholders}}
| Stakeholder | Impact | Notification | Source |
|-------------|--------|--------------|--------|
{{#each deployment.communication.stakeholders}}
| {{this.stakeholder}} | {{this.impact}} | {{this.notification}} | `{{this.source}}` |
{{/each}}
{{else}}
| Stakeholder | Impact | Notification |
|-------------|--------|--------------|
| End Users | {{metadata.cics_count}} online transactions | Pre/Post deployment |
| Batch Operations | {{metadata.jcl_count}} job changes | Schedule change notice |
| Database Team | {{metadata.db2_table_count}} table migration | Pre-deployment |
| Support Team | All migrated services | Training, runbook |
{{/if}}

### 8.2 Notification Templates

**Pre-Deployment:**
```
Subject: [{{project.name}}] Migration Deployment - {{deployment.date}}

Migration Scope:
- {{metadata.source_analysis.total_files}} COBOL programs → Java services
- {{metadata.jcl_count}} batch jobs → Spring Batch
- {{metadata.cics_count}} online transactions → REST APIs

Deployment Window: [TIME]
Expected Downtime: [DURATION]
```

**Post-Deployment Success:**
```
Subject: [{{project.name}}] Migration Completed Successfully

All {{metadata.source_analysis.total_files}} services deployed and validated.
System is operational.

Please report any issues to [SUPPORT].
```

**Rollback Notification:**
```
Subject: [URGENT] [{{project.name}}] Deployment Rolled Back

Reason: [REASON]
Impact: [DESCRIPTION]
Status: Previous version restored

Next Steps: [PLAN]
```

---

## 9. Post-Deployment Tasks

### 9.1 Immediate Tasks (0-24 hours)

**Source:** Deployment validation requirements

- [ ] Verify all {{metadata.source_analysis.total_files}} services healthy
- [ ] Validate {{metadata.db2_table_count}} database tables
- [ ] Confirm {{metadata.jcl_count}} batch jobs scheduled
- [ ] Execute smoke tests for critical functions
- [ ] Monitor error rates and performance
- [ ] Send deployment success notification

### 9.2 Short-term Tasks (Week 1)

**Source:** Migration scope

- [ ] Complete data migration validation
- [ ] Run full regression test suite
- [ ] Verify all {{metadata.cics_count}} transaction equivalents
- [ ] Document any issues and workarounds
- [ ] Conduct daily stand-up with support team

### 9.3 Long-term Tasks (Month 1)

**Source:** Decommissioning plan

- [ ] Decommission COBOL programs ({{metadata.source_analysis.total_files}})
- [ ] Archive JCL jobs ({{metadata.jcl_count}})
- [ ] Update operational documentation
- [ ] Complete knowledge transfer
- [ ] Conduct lessons learned session

---

## Appendices

### Appendix A: Deployment Artifact Manifest

{{#if appendix.artifacts}}
| Artifact | Version | Source | Checksum |
|----------|---------|--------|----------|
{{#each appendix.artifacts}}
| {{this.artifact}} | {{this.version}} | `{{this.source}}` | {{this.checksum}} |
{{/each}}
{{/if}}

### Appendix B: Rollback Scripts

{{#if appendix.rollback_scripts}}
{{#each appendix.rollback_scripts}}
#### {{this.name}}

```bash
{{{this.script}}}
```

---

{{/each}}
{{/if}}

### Appendix C: Validation Queries

{{#if appendix.validation_queries}}
{{#each appendix.validation_queries}}
#### {{this.name}}

```sql
{{{this.query}}}
```

---

{{/each}}
{{/if}}

### Appendix D: Contact List

{{#if appendix.contacts}}
| Role | Name | Contact | Responsibility |
|------|------|---------|----------------|
{{#each appendix.contacts}}
| {{this.role}} | {{this.name}} | {{this.contact}} | {{this.responsibility}} |
{{/each}}
{{/if}}

---

## Traceability Note

All deployment and rollback procedures in this document are derived from COBOL source analysis. Component counts, dependencies, and migration artifacts are traced to original source files. Items marked "Not found in source" require manual planning or additional analysis.

---

## Document History

| Version | Date | Author | Changes |
|---------|------|--------|---------|
| {{version}} | {{generated_date}} | {{author}} | Auto-generated from source analysis |

---

**End of Deployment & Rollback Plan**
