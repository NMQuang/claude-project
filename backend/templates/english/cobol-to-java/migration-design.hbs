# Migration Design Document (COBOL → Java)

## Document Information

| Item | Details |
|------|---------|
| **Project Name** | {{project.name}} |
| **Migration Type** | COBOL → Java |
| **Document Type** | Migration Design (Code & Database) |
| **Generated Date** | {{generated_date}} |
| **Version** | {{version}} |

---

## 1. Source-to-Target Architecture Mapping

### 1.1 Architecture Derived from Source Analysis

**Source:** COBOL program structure and dependency analysis

{{#if architecture.source_derived}}
| Source Component | Target Component | Pattern | Source Evidence |
|------------------|------------------|---------|-----------------|
{{#each architecture.source_derived}}
| {{this.source}} | {{this.target}} | {{this.pattern}} | `{{this.evidence}}` |
{{/each}}
{{else}}
| Source Component | Target Component | Pattern | Source |
|------------------|------------------|---------|--------|
| COBOL Programs ({{metadata.source_analysis.total_files}}) | Java Classes | 1:N | Program scan |
| Copybooks ({{metadata.copybook_count}}) | DTO/Entity Classes | 1:1 | COPY extraction |
| JCL Jobs ({{metadata.jcl_count}}) | Spring Batch Jobs | 1:1 | JCL scan |
| DB2 Tables ({{metadata.db2_table_count}}) | JPA Entities | 1:1 | EXEC SQL extraction |

> Source-specific architecture mapping requires complete dependency analysis.
{{/if}}

### 1.2 Layer Mapping from Source

**Source:** COBOL division and paragraph analysis

{{#if architecture.layer_mapping}}
| COBOL Division/Section | Java Layer | Components | Source Locations |
|------------------------|------------|------------|------------------|
{{#each architecture.layer_mapping}}
| {{this.cobol_layer}} | {{this.java_layer}} | {{this.components}} | {{this.locations}} |
{{/each}}
{{else}}
| COBOL Division/Section | Java Layer | Rationale |
|------------------------|------------|-----------|
| PROCEDURE DIVISION | Service Layer | Business logic |
| WORKING-STORAGE | Model/DTO | Data structures |
| FILE SECTION | Repository Layer | Data access |
| COPY statements | Shared DTOs | Reusable structures |
| EXEC SQL | JPA/Repository | Database operations |
| EXEC CICS | Controller/API | UI/Transaction handling |

> Layer mapping requires COBOL structure analysis.
{{/if}}

---

## 2. Program-to-Class Design

### 2.1 COBOL Program to Java Class Mapping

**Source:** COBOL program inventory and structure analysis

{{#if design.program_mapping}}
| COBOL Program | Java Class | Package | Type | Source Path |
|---------------|------------|---------|------|-------------|
{{#each design.program_mapping}}
| {{this.cobol_program}} | {{this.java_class}} | {{this.package}} | {{this.type}} | `{{this.source}}` |
{{/each}}
{{else}}
> **Not found in source:** Program-to-class mapping requires detailed analysis.
{{/if}}

### 2.2 Paragraph to Method Mapping

**Source:** PROCEDURE DIVISION paragraph extraction

{{#if design.paragraph_mapping}}
{{#each design.paragraph_mapping}}
#### Program: {{this.program}}

**Source:** `{{this.source_path}}`

| Paragraph | Java Method | Visibility | Parameters | Source Location |
|-----------|-------------|------------|------------|-----------------|
{{#each this.paragraphs}}
| {{this.paragraph}} | {{this.method}} | {{this.visibility}} | {{this.params}} | `{{this.location}}` |
{{/each}}

{{/each}}
{{else}}
> **Not found in source:** Paragraph-to-method mapping requires PROCEDURE DIVISION analysis.
{{/if}}

### 2.3 Detailed Class Design from Source

**Source:** COBOL program analysis

{{#if design.class_details}}
{{#each design.class_details}}
#### Class: {{this.class_name}}

**Source Program:** `{{this.source_program}}`

**Source Path:** `{{this.source_path}}`

**Responsibilities (Derived from COBOL):**
{{#each this.responsibilities}}
- {{this.description}} (Source: `{{this.source_location}}`)
{{/each}}

**Methods (From Paragraphs):**
| Method | Return Type | Parameters | Source Paragraph | Lines |
|--------|-------------|------------|------------------|-------|
{{#each this.methods}}
| `{{this.name}}` | {{this.return_type}} | {{this.params}} | {{this.source_paragraph}} | {{this.lines}} |
{{/each}}

**Fields (From WORKING-STORAGE):**
| Field | Java Type | Source Variable | PIC Clause | Source Location |
|-------|-----------|-----------------|------------|-----------------|
{{#each this.fields}}
| `{{this.name}}` | {{this.java_type}} | {{this.cobol_var}} | {{this.pic}} | `{{this.location}}` |
{{/each}}

---

{{/each}}
{{else}}
> **Not found in source:** Class design details require complete program analysis.
{{/if}}

---

## 3. Copybook to DTO/Entity Design

### 3.1 Copybook Structure Mapping

**Source:** Copybook file parsing

{{#if design.copybook_mapping}}
{{#each design.copybook_mapping}}
#### Copybook: {{this.copybook_name}}

**Source Path:** `{{this.path}}`

**Target Class:** `{{this.target_class}}`

**Used By:** {{this.used_by_programs}}

**COBOL Structure:**
```cobol
{{{this.cobol_structure}}}
```

**Java DTO Design:**
```java
{{{this.java_dto}}}
```

**Field Mapping:**
| Level | COBOL Field | PIC | Java Field | Java Type | Validation | Source Line |
|-------|-------------|-----|------------|-----------|------------|-------------|
{{#each this.fields}}
| {{this.level}} | {{this.cobol_name}} | {{this.pic}} | {{this.java_name}} | {{this.java_type}} | {{this.validation}} | {{this.line}} |
{{/each}}

---

{{/each}}
{{else}}
> **Not found in source:** Copybook-to-DTO mapping requires copybook analysis.
{{/if}}

### 3.2 REDEFINES Handling

**Source:** REDEFINES clause extraction

{{#if design.redefines}}
| Copybook | Original Field | Redefines Field | Handling Strategy | Source Location |
|----------|----------------|-----------------|-------------------|-----------------|
{{#each design.redefines}}
| {{this.copybook}} | {{this.original}} | {{this.redefines}} | {{this.strategy}} | `{{this.location}}` |
{{/each}}
{{else}}
> **Not found in source:** No REDEFINES clauses detected for handling.
{{/if}}

### 3.3 OCCURS/Array Handling

**Source:** OCCURS clause extraction

{{#if design.occurs}}
| Copybook | Field | OCCURS | DEPENDING ON | Java Collection | Source Location |
|----------|-------|--------|--------------|-----------------|-----------------|
{{#each design.occurs}}
| {{this.copybook}} | {{this.field}} | {{this.occurs}} | {{this.depending_on}} | {{this.java_type}} | `{{this.location}}` |
{{/each}}
{{else}}
> **Not found in source:** No OCCURS clauses detected for handling.
{{/if}}

---

## 4. Database Design

### 4.1 DB2 to Java/JPA Mapping

**Source:** EXEC SQL and DCLGEN extraction

{{#if design.db2_mapping}}
{{#each design.db2_mapping}}
#### Table: {{this.table_name}}

**Source DCLGEN:** `{{this.dclgen_path}}`

**Used In Programs:** {{this.programs}}

**JPA Entity Design:**
```java
{{{this.jpa_entity}}}
```

**Column Mapping:**
| DB2 Column | DB2 Type | JPA Field | Java Type | Annotations | Source |
|------------|----------|-----------|-----------|-------------|--------|
{{#each this.columns}}
| {{this.db2_column}} | {{this.db2_type}} | {{this.jpa_field}} | {{this.java_type}} | {{this.annotations}} | `{{this.source}}` |
{{/each}}

---

{{/each}}
{{else}}
> **Not found in source:** No EXEC SQL/DCLGEN detected for database mapping.
{{/if}}

### 4.2 SQL Statement Transformation

**Source:** EXEC SQL block extraction

{{#if design.sql_transformation}}
{{#each design.sql_transformation}}
#### SQL: {{this.id}}

**Source Program:** `{{this.program}}`

**Source Location:** `{{this.location}}`

**Original DB2 SQL:**
```sql
{{{this.original_sql}}}
```

**Target Implementation:**
```java
{{{this.java_implementation}}}
```

**Host Variable Mapping:**
| Host Variable | COBOL Type | Java Parameter | Notes |
|---------------|------------|----------------|-------|
{{#each this.host_vars}}
| {{this.host_var}} | {{this.cobol_type}} | {{this.java_param}} | {{this.notes}} |
{{/each}}

---

{{/each}}
{{else}}
> **Not found in source:** SQL transformation requires EXEC SQL analysis.
{{/if}}

### 4.3 Cursor to Repository Method Mapping

**Source:** DECLARE CURSOR extraction

{{#if design.cursor_mapping}}
| Cursor Name | Program | Repository Method | Return Type | Source Location |
|-------------|---------|-------------------|-------------|-----------------|
{{#each design.cursor_mapping}}
| {{this.cursor}} | {{this.program}} | {{this.method}} | {{this.return_type}} | `{{this.location}}` |
{{/each}}
{{else}}
> **Not found in source:** No DECLARE CURSOR statements detected.
{{/if}}

---

## 5. File I/O Design

### 5.1 VSAM to Java File Mapping

**Source:** FILE SECTION and SELECT/ASSIGN extraction

{{#if design.vsam_mapping}}
{{#each design.vsam_mapping}}
#### File: {{this.dd_name}}

**Source Program:** `{{this.program}}`

**Source Location:** `{{this.location}}`

**COBOL Definition:**
```cobol
{{{this.cobol_definition}}}
```

**File Attributes:**
| Attribute | COBOL Value | Java Implementation |
|-----------|-------------|---------------------|
| Organization | {{this.organization}} | {{this.java_impl}} |
| Access Mode | {{this.access_mode}} | {{this.java_access}} |
| Record Key | {{this.record_key}} | {{this.java_key}} |
| Record Length | {{this.record_length}} | {{this.java_record}} |

**Java Implementation:**
```java
{{{this.java_code}}}
```

---

{{/each}}
{{else}}
> **Not found in source:** No VSAM file definitions detected.
{{/if}}

### 5.2 File I/O Statement Mapping

**Source:** File I/O statement extraction

{{#if design.file_io_mapping}}
| COBOL Statement | Occurrences | Java Equivalent | Example Source |
|-----------------|-------------|-----------------|----------------|
{{#each design.file_io_mapping}}
| {{this.cobol_stmt}} | {{this.count}} | {{this.java_equiv}} | `{{this.example}}` |
{{/each}}
{{else}}
| COBOL Statement | Java Equivalent |
|-----------------|-----------------|
| OPEN INPUT | FileReader / BufferedReader |
| OPEN OUTPUT | FileWriter / BufferedWriter |
| READ | reader.readLine() |
| WRITE | writer.write() |
| REWRITE | RandomAccessFile |
| DELETE | Files.delete() |
| CLOSE | reader/writer.close() |

> File I/O mapping requires FILE SECTION analysis.
{{/if}}

---

## 6. CICS Transaction Design

### 6.1 CICS to Spring MVC Mapping

**Source:** EXEC CICS command extraction

{{#if design.cics_mapping}}
{{#each design.cics_mapping}}
#### Transaction: {{this.transaction_id}}

**Source Program:** `{{this.program}}`

**Source Path:** `{{this.path}}`

**CICS Commands:**
| Command | Resource | Java Equivalent | Source Location |
|---------|----------|-----------------|-----------------|
{{#each this.commands}}
| {{this.command}} | {{this.resource}} | {{this.java_equiv}} | `{{this.location}}` |
{{/each}}

**Controller Design:**
```java
{{{this.controller_code}}}
```

---

{{/each}}
{{else}}
> **Not found in source:** No EXEC CICS commands detected.
{{/if}}

### 6.2 BMS Map to View Mapping

**Source:** BMS mapset extraction

{{#if design.bms_mapping}}
| BMS Map | Fields | Java View | Template | Source Path |
|---------|--------|-----------|----------|-------------|
{{#each design.bms_mapping}}
| {{this.map_name}} | {{this.field_count}} | {{this.java_view}} | {{this.template}} | `{{this.path}}` |
{{/each}}
{{else}}
> **Not found in source:** No BMS mapsets detected.
{{/if}}

---

## 7. Batch Job Design

### 7.1 JCL to Spring Batch Mapping

**Source:** JCL job parsing

{{#if design.jcl_mapping}}
{{#each design.jcl_mapping}}
#### Job: {{this.job_name}}

**Source Path:** `{{this.path}}`

**JCL Structure:**
```jcl
{{{this.jcl_snippet}}}
```

**Spring Batch Design:**
```java
{{{this.spring_batch_code}}}
```

**Step Mapping:**
| JCL Step | Program | Spring Step | Tasklet/Chunk | Source |
|----------|---------|-------------|---------------|--------|
{{#each this.steps}}
| {{this.jcl_step}} | {{this.program}} | {{this.spring_step}} | {{this.type}} | `{{this.source}}` |
{{/each}}

---

{{/each}}
{{else}}
> **Not found in source:** No JCL jobs detected.
{{/if}}

### 7.2 DD Statement to Resource Mapping

**Source:** JCL DD statement extraction

{{#if design.dd_mapping}}
| DD Name | DSN/File | Java Resource | Type | Source Job |
|---------|----------|---------------|------|------------|
{{#each design.dd_mapping}}
| {{this.dd_name}} | {{this.dsn}} | {{this.java_resource}} | {{this.type}} | `{{this.job}}` |
{{/each}}
{{else}}
> **Not found in source:** DD statement mapping requires JCL analysis.
{{/if}}

---

## 8. Package Structure Design

### 8.1 Package Structure from Source

**Source:** Derived from COBOL program categories

{{#if design.package_structure}}
```
{{{design.package_structure}}}
```
{{else}}
```
com.{{project.package_base}}/
├── batch/                  # From JCL batch programs
│   ├── job/               # Spring Batch job configs
│   ├── step/              # Step implementations
│   └── tasklet/           # Tasklet processors
├── online/                # From CICS programs
│   ├── controller/        # REST/Web controllers
│   └── view/              # View models
├── service/               # Business logic
│   ├── impl/              # Service implementations
│   └── dto/               # Data transfer objects
├── repository/            # Data access
│   ├── entity/            # JPA entities
│   └── mapper/            # MyBatis mappers (if used)
├── model/                 # From copybooks
│   ├── dto/               # DTOs from copybooks
│   └── domain/            # Domain models
├── util/                  # Utility classes
│   ├── converter/         # Type converters
│   └── validation/        # Validators
└── config/                # Configuration
    ├── batch/             # Batch config
    └── db/                # Database config
```

> Package structure derived from program classification.
{{/if}}

### 8.2 Module Dependencies

**Source:** CALL and COPY dependency analysis

{{#if design.module_dependencies}}
```mermaid
{{{design.module_dependencies}}}
```
{{else}}
> **Not found in source:** Module dependency graph requires CALL analysis.
{{/if}}

---

## 9. Data Type Conversion Design

### 9.1 PIC Clause to Java Type Mapping

**Source:** DATA DIVISION PIC clause extraction

{{#if design.pic_mapping}}
| PIC Pattern | Occurrences | Java Type | Conversion Method | Example Source |
|-------------|-------------|-----------|-------------------|----------------|
{{#each design.pic_mapping}}
| `{{this.pic}}` | {{this.count}} | {{this.java_type}} | {{this.conversion}} | `{{this.example}}` |
{{/each}}
{{else}}
| PIC Pattern | Java Type | Conversion Notes |
|-------------|-----------|------------------|
| PIC 9(n) where n≤9 | int | Direct conversion |
| PIC 9(n) where n>9 | long | Direct conversion |
| PIC 9(n)V9(m) | BigDecimal | Scale = m |
| PIC S9(n) | int/long | Handle sign |
| PIC S9(n)V9(m) | BigDecimal | Handle sign, scale = m |
| PIC X(n) | String | Trim trailing spaces |
| PIC A(n) | String | Alphabetic only |
| PIC 9(n) COMP | int/long | Binary format |
| PIC 9(n) COMP-3 | BigDecimal | Packed decimal |

> PIC-to-Java mapping requires DATA DIVISION analysis.
{{/if}}

### 9.2 Numeric Precision Handling

**Source:** Numeric field analysis

{{#if design.numeric_handling}}
| Field | PIC | Java Type | Precision | Scale | Rounding | Source |
|-------|-----|-----------|-----------|-------|----------|--------|
{{#each design.numeric_handling}}
| {{this.field}} | {{this.pic}} | {{this.java_type}} | {{this.precision}} | {{this.scale}} | {{this.rounding}} | `{{this.source}}` |
{{/each}}
{{else}}
> **Not found in source:** Numeric precision handling requires field analysis.
{{/if}}

---

## 10. Error Handling Design

### 10.1 COBOL Error Handling to Java Exception Mapping

**Source:** Error handling pattern extraction

{{#if design.error_handling}}
| COBOL Pattern | Occurrences | Java Exception | Handling Strategy | Example Source |
|---------------|-------------|----------------|-------------------|----------------|
{{#each design.error_handling}}
| {{this.cobol_pattern}} | {{this.count}} | {{this.java_exception}} | {{this.strategy}} | `{{this.source}}` |
{{/each}}
{{else}}
| COBOL Pattern | Java Exception |
|---------------|----------------|
| FILE STATUS ≠ 00 | IOException / FileProcessingException |
| SQLCODE < 0 | DataAccessException |
| SQLCODE = 100 | EmptyResultDataAccessException |
| CICS EIBRESP ≠ 0 | TransactionException |
| ABEND | RuntimeException subclass |

> Error handling mapping requires source pattern analysis.
{{/if}}

### 10.2 Return Code Mapping

**Source:** RETURN-CODE and status field extraction

{{#if design.return_codes}}
| Program | Return Code | Meaning | Java Handling | Source Location |
|---------|-------------|---------|---------------|-----------------|
{{#each design.return_codes}}
| {{this.program}} | {{this.code}} | {{this.meaning}} | {{this.java_handling}} | `{{this.location}}` |
{{/each}}
{{else}}
> **Not found in source:** Return code mapping requires program analysis.
{{/if}}

---

## 11. Configuration Design

### 11.1 Externalized Configuration from Source

**Source:** Hardcoded values and PARM extraction

{{#if design.config_mapping}}
| Source Location | Hardcoded Value | Config Property | Type | Source |
|-----------------|-----------------|-----------------|------|--------|
{{#each design.config_mapping}}
| {{this.location}} | {{this.value}} | {{this.property}} | {{this.type}} | `{{this.source}}` |
{{/each}}
{{else}}
> **Not found in source:** Configuration mapping requires hardcoded value extraction.
{{/if}}

### 11.2 Environment-Specific Settings

**Source:** JCL PARM, SYSIN, and environment references

{{#if design.env_settings}}
| Setting | JCL Source | Config Property | Default Value | Source |
|---------|------------|-----------------|---------------|--------|
{{#each design.env_settings}}
| {{this.setting}} | {{this.jcl_source}} | {{this.property}} | {{this.default}} | `{{this.source}}` |
{{/each}}
{{else}}
> **Not found in source:** Environment settings require JCL analysis.
{{/if}}

---

## 12. Testing Design Considerations

### 12.1 Unit Test Coverage from Source

**Source:** Business logic complexity analysis

{{#if design.test_coverage}}
| Class | Methods | Complexity | Test Priority | Source Evidence |
|-------|---------|------------|---------------|-----------------|
{{#each design.test_coverage}}
| {{this.class}} | {{this.methods}} | {{this.complexity}} | {{this.priority}} | `{{this.source}}` |
{{/each}}
{{else}}
> **Not found in source:** Test coverage plan requires complexity analysis.
{{/if}}

### 12.2 Critical Business Logic for Testing

**Source:** Business rule extraction

{{#if design.critical_logic}}
| Business Logic | Source Program | Source Location | Test Cases Required |
|----------------|----------------|-----------------|---------------------|
{{#each design.critical_logic}}
| {{this.logic}} | {{this.program}} | `{{this.location}}` | {{this.test_cases}} |
{{/each}}
{{else}}
> **Not found in source:** Critical logic identification requires business rule extraction.
{{/if}}

---

## Appendices

### Appendix A: Complete Program-to-Class Matrix

{{#if appendix.program_matrix}}
| Program | Type | LOC | Classes | Source Path |
|---------|------|-----|---------|-------------|
{{#each appendix.program_matrix}}
| {{this.program}} | {{this.type}} | {{this.loc}} | {{this.classes}} | `{{this.path}}` |
{{/each}}
{{/if}}

### Appendix B: Copybook-to-DTO Matrix

{{#if appendix.copybook_matrix}}
| Copybook | Fields | DTO Class | Used By | Source Path |
|----------|--------|-----------|---------|-------------|
{{#each appendix.copybook_matrix}}
| {{this.copybook}} | {{this.fields}} | {{this.dto}} | {{this.used_by}} | `{{this.path}}` |
{{/each}}
{{/if}}

### Appendix C: DB2 Table-to-Entity Matrix

{{#if appendix.db2_matrix}}
| Table | Columns | Entity Class | Source Programs |
|-------|---------|--------------|-----------------|
{{#each appendix.db2_matrix}}
| {{this.table}} | {{this.columns}} | {{this.entity}} | {{this.programs}} |
{{/each}}
{{/if}}

---

## Traceability Note

All design decisions in this document are derived from COBOL source code analysis. Each component includes source evidence (file name, line number). Items marked "Not found in source" require manual analysis or design decisions.

---

## Document History

| Version | Date | Author | Changes |
|---------|------|--------|---------|
| {{version}} | {{generated_date}} | {{author}} | Auto-generated from source analysis |

---

**End of Migration Design Document**
