# Test Strategy Document (PostgreSQL → Oracle)

## Document Information

| Item | Details |
|------|---------|
| **Project Name** | {{project.name}} |
| **Migration Type** | PostgreSQL → Oracle |
| **Document Type** | Test Strategy |
| **Generated Date** | {{generated_date}} |
| **Version** | {{version}} |

---

## 1. Test Scope from Source Analysis

### 1.1 Scope Summary

**Source:** PostgreSQL catalog and application code inventory

| Component | Count | Test Coverage Required | Source |
|-----------|-------|------------------------|--------|
| Database Tables | {{metadata.source_analysis.database.tables}} | Schema + Data validation | `pg_tables` |
| Views | {{metadata.source_analysis.database.views}} | Query result validation | `pg_views` |
| Functions/Procedures | {{metadata.source_analysis.database.functions}} | Unit test each | `pg_proc` |
| Triggers | {{metadata.source_analysis.database.triggers}} | Integration test | `pg_trigger` |
| Native SQL Queries | {{metadata.source_analysis.nativeQueryCount}} | Query result validation | @Query extraction |
| Entity Classes | {{metadata.source_analysis.entityCount}} | Mapping validation | JPA scan |
| Sequences | {{metadata.source_analysis.database.sequences}} | Auto-increment test | `pg_sequences` |

### 1.2 Components with PostgreSQL-Specific Features

**Source:** PostgreSQL feature detection

{{#if testing.pg_feature_scope}}
| Component | PostgreSQL Feature | Test Priority | Source |
|-----------|-------------------|---------------|--------|
{{#each testing.pg_feature_scope}}
| {{this.component}} | {{this.feature}} | {{this.priority}} | `{{this.source}}` |
{{/each}}
{{else}}
> **Not found in source:** Feature-specific scope requires detailed analysis.
{{/if}}

---

## 2. Schema Validation Testing

### 2.1 DDL Validation Test Cases

**Source:** PostgreSQL DDL extraction

{{#if testing.ddl_validation}}
| Test ID | Object | Validation | Expected | Source |
|---------|--------|------------|----------|--------|
{{#each testing.ddl_validation}}
| {{this.id}} | {{this.object}} | {{this.validation}} | {{this.expected}} | `{{this.source}}` |
{{/each}}
{{else}}
| Test ID | Validation | Expected | Source |
|---------|------------|----------|--------|
| DDL-001 | Table count | {{metadata.source_analysis.database.tables}} tables | pg_tables |
| DDL-002 | View count | {{metadata.source_analysis.database.views}} views | pg_views |
| DDL-003 | Sequence count | {{metadata.source_analysis.database.sequences}} sequences | pg_sequences |
| DDL-004 | Index count | {{metadata.source_analysis.database.indexes}} indexes | pg_indexes |
| DDL-005 | Constraint count | All constraints migrated | pg_constraint |
| DDL-006 | Column definitions | Types correctly mapped | information_schema |
| DDL-007 | Primary keys | All PKs created | pg_constraint |
| DDL-008 | Foreign keys | All FKs created | pg_constraint |
{{/if}}

### 2.2 Column Type Mapping Tests

**Source:** Data type inventory

{{#if testing.type_mapping_tests}}
{{#each testing.type_mapping_tests}}
#### Type: {{this.pgType}} → {{this.oracleType}}

**Occurrences:** {{this.count}}

**Test Cases:**
| Test | Input | Expected | Source Table |
|------|-------|----------|--------------|
{{#each this.testCases}}
| {{this.test}} | {{this.input}} | {{this.expected}} | {{this.table}} |
{{/each}}

---

{{/each}}
{{else}}
| PostgreSQL Type | Oracle Type | Test Validation |
|-----------------|-------------|-----------------|
| BOOLEAN | NUMBER(1) | TRUE→1, FALSE→0 |
| TEXT | CLOB | Large text preserved |
| JSONB | CLOB/JSON | JSON structure intact |
| UUID | VARCHAR2(36) | Format preserved |
| ARRAY[] | VARCHAR2/CLOB | Values preserved |
| SERIAL | NUMBER+SEQ | Auto-increment works |

> Type mapping tests require DDL analysis.
{{/if}}

---

## 3. Data Migration Validation

### 3.1 Row Count Validation

**Source:** Table inventory

{{#if testing.row_count_validation}}
| Table | PostgreSQL Count | Oracle Count | Status | Source |
|-------|------------------|--------------|--------|--------|
{{#each testing.row_count_validation}}
| {{this.table}} | {{this.pgCount}} | {{this.oracleCount}} | {{this.status}} | `{{this.source}}` |
{{/each}}
{{else}}
**Validation Query Template:**

```sql
-- PostgreSQL
SELECT 'table_name' as table_name, COUNT(*) as row_count FROM table_name;

-- Oracle
SELECT 'table_name' as table_name, COUNT(*) as row_count FROM table_name;

-- All counts must match 100%
```

> Row count validation requires data migration.
{{/if}}

### 3.2 Data Integrity Validation

**Source:** Data type and constraint analysis

{{#if testing.data_integrity}}
{{#each testing.data_integrity}}
#### Table: {{this.table}}

**Validation Tests:**
| Test | Query | Expected | Source |
|------|-------|----------|--------|
{{#each this.tests}}
| {{this.test}} | `{{this.query}}` | {{this.expected}} | `{{this.source}}` |
{{/each}}

---

{{/each}}
{{else}}
| Validation | Method | Criteria |
|------------|--------|----------|
| Row counts | COUNT(*) comparison | 100% match |
| Checksum | MD5/SHA hash | Match |
| NULL values | NULL count per column | Match |
| Referential integrity | FK validation | No orphans |
| Unique constraints | Duplicate check | No violations |
| Sample data | Random 10% inspection | Match |
{{/if}}

### 3.3 Data Transformation Validation

**Source:** Data type transformation analysis

{{#if testing.transformation_validation}}
| Table | Column | Transformation | Test Case | Expected | Source |
|-------|--------|----------------|-----------|----------|--------|
{{#each testing.transformation_validation}}
| {{this.table}} | {{this.column}} | {{this.transformation}} | {{this.testCase}} | {{this.expected}} | `{{this.source}}` |
{{/each}}
{{else}}
| Transformation | Test |
|----------------|------|
| BOOLEAN → NUMBER(1) | Verify TRUE→1, FALSE→0 |
| ARRAY → VARCHAR2 | Verify all elements preserved |
| JSONB → CLOB | Verify JSON structure valid |
| SERIAL → SEQUENCE | Verify next value correct |

> Transformation tests require data analysis.
{{/if}}

---

## 4. SQL Query Validation

### 4.1 Native Query Test Cases

**Source:** @Query annotation extraction

{{#if testing.native_query_tests}}
{{#each testing.native_query_tests}}
#### Repository: {{this.repository}}

**File:** `{{this.file}}`

| Method | PostgreSQL Result | Oracle Result | Match | Source |
|--------|-------------------|---------------|-------|--------|
{{#each this.methods}}
| {{this.method}} | {{this.pgResult}} | {{this.oracleResult}} | {{this.match}} | `{{this.source}}` |
{{/each}}

---

{{/each}}
{{else}}
**Test Approach:**
1. Execute each @Query on PostgreSQL, capture results
2. Execute converted query on Oracle
3. Compare result sets (structure, values, ordering)
4. Verify method signatures unchanged

> Native query tests require code extraction.
{{/if}}

### 4.2 Pagination Query Tests

**Source:** LIMIT/OFFSET usage detection

{{#if testing.pagination_tests}}
| Query Location | PostgreSQL | Oracle | Test Data | Source |
|----------------|------------|--------|-----------|--------|
{{#each testing.pagination_tests}}
| `{{this.location}}` | {{this.pgQuery}} | {{this.oracleQuery}} | {{this.testData}} | `{{this.source}}` |
{{/each}}
{{else}}
| Test | PostgreSQL | Oracle | Validation |
|------|------------|--------|------------|
| LIMIT 10 | LIMIT 10 | FETCH FIRST 10 ROWS ONLY | Same 10 rows |
| OFFSET 20 | OFFSET 20 | OFFSET 20 ROWS | Same starting point |
| Combined | LIMIT 10 OFFSET 20 | OFFSET 20 ROWS FETCH FIRST 10 ROWS ONLY | Same result set |

> Pagination tests require query extraction.
{{/if}}

### 4.3 JSON Query Tests

**Source:** JSONB operator usage detection

{{#if testing.json_tests}}
| Query | PostgreSQL Operator | Oracle Function | Test | Source |
|-------|---------------------|-----------------|------|--------|
{{#each testing.json_tests}}
| {{this.query}} | {{this.pgOperator}} | {{this.oracleFunc}} | {{this.test}} | `{{this.source}}` |
{{/each}}
{{else}}
| Operation | PostgreSQL | Oracle | Test |
|-----------|------------|--------|------|
| Get text value | data->>'key' | JSON_VALUE(data, '$.key') | Same value |
| Get object | data->'key' | JSON_QUERY(data, '$.key') | Same JSON |
| Filter by value | WHERE data->>'key'='x' | WHERE JSON_VALUE(data,'$.key')='x' | Same rows |

> JSON tests require JSON usage analysis.
{{/if}}

---

## 5. PL/pgSQL Function Validation

### 5.1 Function Unit Tests

**Source:** pg_proc function inventory

{{#if testing.function_tests}}
{{#each testing.function_tests}}
#### Function: {{this.name}}

**Source:** `{{this.source}}`

**Test Cases:**
| Test ID | Input | PostgreSQL Output | Oracle Output | Status |
|---------|-------|-------------------|---------------|--------|
{{#each this.testCases}}
| {{this.id}} | {{this.input}} | {{this.pgOutput}} | {{this.oracleOutput}} | {{this.status}} |
{{/each}}

---

{{/each}}
{{else}}
**Test Template:**

```sql
-- PostgreSQL
SELECT function_name(param1, param2);
-- Record result

-- Oracle
SELECT function_name(param1, param2) FROM DUAL;
-- Compare result

-- Must match exactly
```

> Function tests require function extraction.
{{/if}}

### 5.2 Trigger Tests

**Source:** pg_trigger extraction

{{#if testing.trigger_tests}}
| Trigger | Table | Event | PostgreSQL Behavior | Oracle Behavior | Source |
|---------|-------|-------|---------------------|-----------------|--------|
{{#each testing.trigger_tests}}
| {{this.name}} | {{this.table}} | {{this.event}} | {{this.pgBehavior}} | {{this.oracleBehavior}} | `{{this.source}}` |
{{/each}}
{{else}}
| Test | Validation |
|------|------------|
| INSERT trigger | Before/After behavior matches |
| UPDATE trigger | Column values correctly modified |
| DELETE trigger | Cascade/restrict behavior matches |

> Trigger tests require trigger analysis.
{{/if}}

---

## 6. Application Layer Testing

### 6.1 Entity Mapping Tests

**Source:** JPA Entity class scan

{{#if testing.entity_tests}}
{{#each testing.entity_tests}}
#### Entity: {{this.entity}}

**File:** `{{this.file}}`

**Test Cases:**
| Test | Operation | Expected | Source |
|------|-----------|----------|--------|
{{#each this.tests}}
| {{this.test}} | {{this.operation}} | {{this.expected}} | `{{this.source}}` |
{{/each}}

---

{{/each}}
{{else}}
**JUnit Test Template:**

```java
@SpringBootTest
@AutoConfigureTestDatabase(replace = Replace.NONE)
class EntityMappingTest {

    @Test
    void testCRUDOperations() {
        // Create
        Entity entity = new Entity();
        entity = repository.save(entity);
        assertNotNull(entity.getId());

        // Read
        Entity found = repository.findById(entity.getId()).orElseThrow();
        assertEquals(entity, found);

        // Update
        found.setField("new value");
        repository.save(found);

        // Delete
        repository.delete(found);
        assertFalse(repository.existsById(entity.getId()));
    }
}
```

> Entity tests require code scan.
{{/if}}

### 6.2 Repository Integration Tests

**Source:** Repository class scan

{{#if testing.repository_tests}}
| Repository | Method | Test Type | Source |
|------------|--------|-----------|--------|
{{#each testing.repository_tests}}
| {{this.repository}} | {{this.method}} | {{this.testType}} | `{{this.source}}` |
{{/each}}
{{else}}
| Test Category | Count | Priority |
|---------------|-------|----------|
| Native queries | {{metadata.source_analysis.nativeQueryCount}} | High |
| JPQL queries | Auto-generated | Medium |
| Derived queries | Auto-generated | Low |

> Repository tests require code scan.
{{/if}}

---

## 7. Performance Testing

### 7.1 Performance Baseline

**Source:** Query execution analysis

{{#if testing.performance.baseline}}
| Query | PostgreSQL Time | Oracle Target | Priority | Source |
|-------|-----------------|---------------|----------|--------|
{{#each testing.performance.baseline}}
| {{this.query}} | {{this.pgTime}} | {{this.oracleTarget}} | {{this.priority}} | `{{this.source}}` |
{{/each}}
{{else}}
| Test Type | PostgreSQL Baseline | Oracle Target |
|-----------|---------------------|---------------|
| Simple SELECT | Record baseline | ≤ Baseline |
| JOIN (2 tables) | Record baseline | ≤ 1.2x Baseline |
| JOIN (5+ tables) | Record baseline | ≤ 1.5x Baseline |
| Aggregation | Record baseline | ≤ Baseline |
| Full-text search | Record baseline | ≤ 1.5x Baseline |

> Performance baseline requires execution timing.
{{/if}}

### 7.2 Load Testing

**Source:** Production traffic analysis

{{#if testing.performance.load}}
| Scenario | Concurrent Users | Duration | Success Criteria | Source |
|----------|-----------------|----------|------------------|--------|
{{#each testing.performance.load}}
| {{this.scenario}} | {{this.users}} | {{this.duration}} | {{this.criteria}} | `{{this.source}}` |
{{/each}}
{{else}}
| Scenario | Users | Duration | Criteria |
|----------|-------|----------|----------|
| Normal | 100 | 30 min | 0% error, <200ms avg |
| Peak | 500 | 15 min | <1% error, <500ms avg |
| Stress | 1000 | 5 min | <5% error, system recovers |
{{/if}}

---

## 8. Rollback Testing

### 8.1 Rollback Scenarios

**Source:** Deployment risk analysis

{{#if testing.rollback.scenarios}}
| Scenario | Trigger | Steps | Expected | Source |
|----------|---------|-------|----------|--------|
{{#each testing.rollback.scenarios}}
| {{this.scenario}} | {{this.trigger}} | {{this.steps}} | {{this.expected}} | `{{this.source}}` |
{{/each}}
{{else}}
| Scenario | Trigger | Test |
|----------|---------|------|
| Immediate rollback | Critical error detected | System functional within 5 min |
| Data sync rollback | After 1 hour operation | Data consistent |
| Partial rollback | Module failure | Other modules unaffected |
{{/if}}

### 8.2 Rollback Validation

**Source:** Rollback procedure design

| Test | Validation | Expected |
|------|------------|----------|
| Application startup | Health check | 200 OK |
| Database connectivity | Query execution | Success |
| Data integrity | Row counts | Match pre-migration |
| Business operations | CRUD operations | All functional |

---

## 9. Test Success Criteria

### 9.1 Success Criteria from Source Metrics

**Source:** Migration scope inventory

| Criteria | Target | Measurement | Source |
|----------|--------|-------------|--------|
| Schema validation | 100% | All {{metadata.source_analysis.database.tables}} tables created | DDL |
| Data integrity | 100% | Row counts match | Data migration |
| Query correctness | 100% | All {{metadata.source_analysis.nativeQueryCount}} queries pass | @Query |
| Function parity | 100% | All {{metadata.source_analysis.database.functions}} functions work | pg_proc |
| Performance | ≤ Baseline | Query times comparable | Performance tests |
| Rollback | Validated | Procedure works | Rollback tests |

### 9.2 Exit Criteria

- [ ] All DDL validation tests pass
- [ ] Data integrity validation 100%
- [ ] All native queries produce correct results
- [ ] All function unit tests pass
- [ ] Performance targets met
- [ ] Rollback procedure tested
- [ ] Zero critical/high defects open

---

## Appendices

### Appendix A: Test Case Matrix

{{#if appendix.test_matrix}}
| Component | Unit Tests | Integration | Performance | Total |
|-----------|------------|-------------|-------------|-------|
{{#each appendix.test_matrix}}
| {{this.component}} | {{this.unit}} | {{this.integration}} | {{this.performance}} | {{this.total}} |
{{/each}}
{{/if}}

### Appendix B: Data Validation Queries

{{#if appendix.validation_queries}}
{{#each appendix.validation_queries}}
#### {{this.name}}

```sql
{{{this.query}}}
```

---

{{/each}}
{{/if}}

---

## Traceability Note

All test cases in this document are derived from PostgreSQL source analysis. Each test includes source evidence. Items marked "Not found in source" require manual test design.

---

## Document History

| Version | Date | Author | Changes |
|---------|------|--------|---------|
| {{version}} | {{generated_date}} | {{author}} | Auto-generated from source analysis |

---

**End of Test Strategy Document**
