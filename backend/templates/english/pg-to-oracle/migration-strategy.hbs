# Migration Strategy Document (PostgreSQL → Oracle)

## Document Information

| Item | Details |
|------|---------|
| **Project Name** | {{project.name}} |
| **Migration Type** | PostgreSQL → Oracle |
| **Document Type** | Migration Strategy |
| **Generated Date** | {{generated_date}} |
| **Version** | {{version}} |

---

## 1. Source Analysis Summary

### 1.1 Scope from Source Inventory

**Source:** PostgreSQL catalog extraction and application code scan

| Metric | Value | Source |
|--------|-------|--------|
| Database Tables | {{metadata.source_analysis.database.tables}} | `pg_tables` catalog |
| Views | {{metadata.source_analysis.database.views}} | `pg_views` catalog |
| Functions/Procedures | {{metadata.source_analysis.database.functions}} | `pg_proc` catalog |
| Triggers | {{metadata.source_analysis.database.triggers}} | `pg_trigger` catalog |
| Sequences | {{metadata.source_analysis.database.sequences}} | `pg_sequences` catalog |
| Application Files | {{metadata.source_analysis.total_files}} | Code scan |
| Native SQL Queries | {{metadata.source_analysis.nativeQueryCount}} | @Query extraction |
| PostgreSQL Extensions | {{metadata.source_analysis.extensionCount}} | `pg_extension` catalog |

### 1.2 Complexity Assessment from Source

**Source:** Multi-dimensional analysis of source artifacts

| Dimension | Score | Level | Key Factors (from Source) |
|-----------|-------|-------|---------------------------|
| Schema & Data Types | {{metadata.complexity.schemaDataType}}/100 | {{metadata.complexity.schemaDataTypeLevel}} | {{metadata.complexity.schemaFactors}} |
| SQL Query Rewrite | {{metadata.complexity.sqlQuery}}/100 | {{metadata.complexity.sqlQueryLevel}} | {{metadata.complexity.sqlFactors}} |
| PL/pgSQL Conversion | {{metadata.complexity.plpgsql}}/100 | {{metadata.complexity.plpgsqlLevel}} | {{metadata.complexity.plpgsqlFactors}} |
| Data Volume | {{metadata.complexity.dataVolume}}/100 | {{metadata.complexity.dataVolumeLevel}} | {{metadata.complexity.dataFactors}} |
| Application/ORM | {{metadata.complexity.application}}/100 | {{metadata.complexity.applicationLevel}} | {{metadata.complexity.appFactors}} |
| Extensions | {{metadata.complexity.extensions}}/100 | {{metadata.complexity.extensionsLevel}} | {{metadata.complexity.extFactors}} |
| **Overall** | **{{metadata.complexity.overall}}/100** | **{{metadata.complexity.overallLevel}}** | |

---

## 2. Migration Approach Selection

### 2.1 Approach Based on Source Metrics

**Source:** Complexity and feature analysis

{{#if strategy.approach_analysis}}
| Factor | Source Value | Approach Implication | Source Evidence |
|--------|--------------|----------------------|-----------------|
{{#each strategy.approach_analysis}}
| {{this.factor}} | {{this.value}} | {{this.implication}} | `{{this.source}}` |
{{/each}}
{{else}}
| Factor | Source Value | Impact |
|--------|--------------|--------|
| PostgreSQL-Specific Types | {{metadata.pgSpecificTypeCount}} | Type conversion required |
| Native SQL Queries | {{metadata.source_analysis.nativeQueryCount}} | Query rewrite required |
| PL/pgSQL Functions | {{metadata.source_analysis.database.functions}} | PL/SQL conversion required |
| Extensions Used | {{metadata.source_analysis.extensionCount}} | Alternative solutions required |
| Partitioned Tables | {{metadata.source_analysis.database.partitionedTables}} | Partitioning redesign needed |

> Approach selection requires complete source analysis.
{{/if}}

### 2.2 Recommended Strategy

**Source:** Based on complexity score {{metadata.complexity.overall}}/100

{{#if (gt metadata.complexity.overall 70)}}
**Strategy:** Phased Migration
- Migrate by module/schema
- Lower risk, easier rollback per module
- Longer overall duration

**Rationale (from Source):**
- High complexity PostgreSQL features detected
- {{metadata.pgSpecificTypeCount}} PostgreSQL-specific type usages
- {{metadata.source_analysis.database.functions}} PL/pgSQL functions to convert
{{else if (gt metadata.complexity.overall 40)}}
**Strategy:** Big Bang with Parallel Running
- Single cutover event
- Parallel systems during validation
- Faster overall migration

**Rationale (from Source):**
- Moderate complexity
- Manageable PostgreSQL feature usage
{{else}}
**Strategy:** Big Bang Cutover
- Direct migration in maintenance window
- Simplest approach
- Fastest completion

**Rationale (from Source):**
- Low complexity
- Minimal PostgreSQL-specific features
{{/if}}

---

## 3. Data Type Mapping Strategy

### 3.1 Type Mapping from Source Analysis

**Source:** DDL extraction and column type inventory

{{#if strategy.type_mapping}}
| PostgreSQL Type | Occurrences | Tables Affected | Oracle Type | Complexity | Source |
|-----------------|-------------|-----------------|-------------|------------|--------|
{{#each strategy.type_mapping}}
| `{{this.pgType}}` | {{this.count}} | {{this.tables}} | `{{this.oracleType}}` | {{this.complexity}} | `{{this.source}}` |
{{/each}}
{{else}}
| PostgreSQL Type | Oracle Equivalent | Notes |
|-----------------|-------------------|-------|
| SERIAL | NUMBER + SEQUENCE + TRIGGER | Auto-increment requires trigger |
| BIGSERIAL | NUMBER(19) + SEQUENCE + TRIGGER | Auto-increment requires trigger |
| BOOLEAN | NUMBER(1) | 0/1 mapping |
| TEXT | CLOB | Direct mapping |
| JSONB | JSON (21c+) / CLOB | Version dependent |
| UUID | RAW(16) / VARCHAR2(36) | SYS_GUID() alternative |
| BYTEA | BLOB | Direct mapping |
| ARRAY[] | VARRAY / Nested Table | Requires redesign |
| INTERVAL | INTERVAL DAY TO SECOND | Different precision |
| TIMESTAMP WITH TIME ZONE | TIMESTAMP WITH TIME ZONE | Direct mapping |

> Detailed type mapping requires DDL analysis.
{{/if}}

### 3.2 PostgreSQL-Specific Type Handling

**Source:** PostgreSQL-specific type detection

{{#if strategy.pg_type_handling}}
{{#each strategy.pg_type_handling}}
#### Type: `{{this.type}}`

**Occurrences:** {{this.count}} columns in {{this.tableCount}} tables

**Affected Objects:**
| Table | Column | Current Usage | Source |
|-------|--------|---------------|--------|
{{#each this.occurrences}}
| {{this.table}} | {{this.column}} | {{this.usage}} | `{{this.source}}` |
{{/each}}

**Migration Strategy:**
- **Oracle Type:** `{{this.oracleType}}`
- **Conversion Logic:** {{this.conversionLogic}}
- **Application Impact:** {{this.appImpact}}

---

{{/each}}
{{else}}
> **Not found in source:** PostgreSQL-specific type handling requires DDL parsing.
{{/if}}

---

## 4. SQL Query Migration Strategy

### 4.1 Query Patterns Detected

**Source:** SQL extraction from application code and stored procedures

{{#if strategy.query_patterns}}
| Pattern | Occurrences | Locations | Oracle Equivalent | Complexity |
|---------|-------------|-----------|-------------------|------------|
{{#each strategy.query_patterns}}
| `{{this.pattern}}` | {{this.count}} | {{this.locations}} | {{this.oracleEquiv}} | {{this.complexity}} |
{{/each}}
{{else}}
| Pattern | Oracle Equivalent |
|---------|-------------------|
| LIMIT n OFFSET m | FETCH FIRST n ROWS ONLY OFFSET m |
| RETURNING clause | RETURNING INTO |
| ON CONFLICT (upsert) | MERGE statement |
| ILIKE | UPPER() LIKE UPPER() |
| array_agg() | LISTAGG() |
| string_agg() | LISTAGG() |
| :: type cast | CAST() or TO_ functions |
| NOW() | SYSDATE / SYSTIMESTAMP |
| CURRENT_TIMESTAMP | SYSTIMESTAMP |
| EXTRACT(epoch FROM) | Custom function |

> Query pattern analysis requires SQL extraction.
{{/if}}

### 4.2 Native Query Rewrite Plan

**Source:** @Query annotation extraction

{{#if strategy.native_query_plan}}
{{#each strategy.native_query_plan}}
#### Query: {{this.id}}

**Location:** `{{this.location}}`

**Original PostgreSQL:**
```sql
{{{this.originalSql}}}
```

**PostgreSQL Features:**
{{#each this.pgFeatures}}
- {{this}}
{{/each}}

**Oracle Conversion:**
```sql
{{{this.oracleSql}}}
```

**Complexity:** {{this.complexity}}

---

{{/each}}
{{else}}
> **Not found in source:** Native query plan requires @Query extraction.
{{/if}}

---

## 5. PL/pgSQL to PL/SQL Strategy

### 5.1 Function/Procedure Conversion Plan

**Source:** pg_proc catalog and function body extraction

{{#if strategy.plpgsql_plan}}
| Function/Procedure | Type | Lines | PG-Specific Constructs | Conversion Complexity | Source |
|--------------------|------|-------|------------------------|----------------------|--------|
{{#each strategy.plpgsql_plan}}
| {{this.name}} | {{this.type}} | {{this.lines}} | {{this.pgConstructs}} | {{this.complexity}} | `{{this.source}}` |
{{/each}}
{{else}}
| Construct | Count | Oracle Equivalent |
|-----------|-------|-------------------|
| Functions | {{metadata.source_analysis.database.functions}} | Oracle Functions |
| Procedures | {{metadata.source_analysis.database.stored_procedures}} | Oracle Procedures |
| Triggers | {{metadata.source_analysis.database.triggers}} | Oracle Triggers |

> Function conversion plan requires body extraction.
{{/if}}

### 5.2 PL/pgSQL Construct Mapping

**Source:** Function body analysis

{{#if strategy.plpgsql_constructs}}
| PL/pgSQL Construct | Occurrences | Oracle Equivalent | Conversion Notes | Source |
|--------------------|-------------|-------------------|------------------|--------|
{{#each strategy.plpgsql_constructs}}
| `{{this.construct}}` | {{this.count}} | `{{this.oracleEquiv}}` | {{this.notes}} | `{{this.source}}` |
{{/each}}
{{else}}
| PL/pgSQL Construct | Oracle PL/SQL |
|--------------------|---------------|
| RETURNS TABLE | SYS_REFCURSOR / Pipelined Function |
| RETURN QUERY | OPEN cursor FOR / PIPE ROW |
| PERFORM statement | EXECUTE IMMEDIATE (if needed) |
| RAISE NOTICE | DBMS_OUTPUT.PUT_LINE |
| RAISE EXCEPTION | RAISE_APPLICATION_ERROR |
| $$ dollar quoting | Standard quote or q'[]' |
| FOREACH .. IN ARRAY | FOR i IN 1..array.COUNT LOOP |

> Construct mapping requires function body analysis.
{{/if}}

---

## 6. Index Migration Strategy

### 6.1 Index Type Conversion

**Source:** pg_indexes catalog extraction

{{#if strategy.index_plan}}
| Index Type | Count | Tables | Oracle Support | Migration Strategy | Source |
|------------|-------|--------|----------------|-------------------|--------|
{{#each strategy.index_plan}}
| {{this.type}} | {{this.count}} | {{this.tables}} | {{this.oracleSupport}} | {{this.strategy}} | `{{this.source}}` |
{{/each}}
{{else}}
| PostgreSQL Index Type | Oracle Alternative | Notes |
|-----------------------|-------------------|-------|
| B-tree | B-tree | Direct conversion |
| GIN | Function-based / Domain Index | For JSONB, ARRAY, Full-text |
| GiST | R-tree / Spatial Index | For geometry, range types |
| BRIN | Partitioning + Local Index | For large sequential data |
| Hash | B-tree | Oracle hash partitioning alternative |
| Partial Index (WHERE) | Function-based Index | May require redesign |

> Index migration plan requires pg_indexes extraction.
{{/if}}

### 6.2 Partial Index Handling

**Source:** Index WHERE clause extraction

{{#if strategy.partial_indexes}}
| Index Name | Table | Condition | Oracle Strategy | Source |
|------------|-------|-----------|-----------------|--------|
{{#each strategy.partial_indexes}}
| {{this.name}} | {{this.table}} | `{{this.condition}}` | {{this.strategy}} | `{{this.source}}` |
{{/each}}
{{else}}
> **Not found in source:** No partial indexes detected or analysis not performed.
{{/if}}

---

## 7. Extension Migration Strategy

### 7.1 Extension Handling Plan

**Source:** pg_extension catalog and usage analysis

{{#if strategy.extension_plan}}
{{#each strategy.extension_plan}}
#### Extension: {{this.name}}

**Version:** {{this.version}}

**Functions Used:**
| Function | Occurrences | Locations | Source |
|----------|-------------|-----------|--------|
{{#each this.functions}}
| {{this.function}} | {{this.count}} | {{this.locations}} | `{{this.source}}` |
{{/each}}

**Oracle Alternative:** {{this.oracleAlternative}}

**Migration Strategy:** {{this.strategy}}

---

{{/each}}
{{else}}
| Extension | Oracle Alternative |
|-----------|-------------------|
| uuid-ossp | SYS_GUID() function |
| pgcrypto | DBMS_CRYPTO package |
| postgis | Oracle Spatial |
| pg_trgm | Oracle Text |
| hstore | JSON or custom table |

> Extension plan requires pg_extension analysis.
{{/if}}

---

## 8. Application Layer Strategy

### 8.1 Minimal Java Changes Principle

**Strategy:** Keep Java application logic unchanged. Changes limited to:
1. Database configuration (JDBC driver, URL, dialect)
2. Entity annotations (only if type mapping fails)
3. Repository queries (@Query rewrite for Oracle syntax)

### 8.2 Required Configuration Changes

**Source:** Application configuration file scan

{{#if strategy.config_changes}}
| File | Property | Current Value | New Value | Source |
|------|----------|---------------|-----------|--------|
{{#each strategy.config_changes}}
| {{this.file}} | {{this.property}} | {{this.current}} | {{this.new}} | `{{this.source}}` |
{{/each}}
{{else}}
| Property | PostgreSQL Value | Oracle Value |
|----------|------------------|--------------|
| driver-class-name | org.postgresql.Driver | oracle.jdbc.OracleDriver |
| url | jdbc:postgresql://host:5432/db | jdbc:oracle:thin:@host:1521:SID |
| dialect | PostgreSQLDialect | Oracle12cDialect |

> Configuration changes require application.properties scan.
{{/if}}

### 8.3 Entity Annotation Changes

**Source:** JPA Entity class scan

{{#if strategy.entity_changes}}
| Entity Class | Field | Current Annotation | Required Change | Source |
|--------------|-------|-------------------|-----------------|--------|
{{#each strategy.entity_changes}}
| {{this.entity}} | {{this.field}} | {{this.current}} | {{this.required}} | `{{this.source}}` |
{{/each}}
{{else}}
> **Not found in source:** Entity annotation analysis requires code scan.
{{/if}}

### 8.4 Repository Query Changes

**Source:** @Query and native query extraction

{{#if strategy.repository_changes}}
| Repository | Method | Query Type | PostgreSQL Features | Change Required | Source |
|------------|--------|------------|---------------------|-----------------|--------|
{{#each strategy.repository_changes}}
| {{this.repository}} | {{this.method}} | {{this.type}} | {{this.pgFeatures}} | {{this.changeRequired}} | `{{this.source}}` |
{{/each}}
{{else}}
> **Not found in source:** Repository analysis requires code scan.
{{/if}}

---

## 9. Data Migration Strategy

### 9.1 Migration Tool Selection

**Source:** Data volume and complexity analysis

{{#if (gt metadata.complexity.dataVolume 60)}}
**Recommended Tool:** AWS DMS or Oracle GoldenGate
- Continuous replication support
- Minimal downtime migration
- Handles heterogeneous migrations
{{else}}
**Recommended Tool:** Oracle SQL Developer + Ora2Pg
- Simpler setup
- Good for one-time migration
- Full control over process
{{/if}}

### 9.2 Data Transformation Requirements

**Source:** Data type and structure analysis

{{#if strategy.data_transformation}}
| Table | Column | Transformation | Reason | Source |
|-------|--------|----------------|--------|--------|
{{#each strategy.data_transformation}}
| {{this.table}} | {{this.column}} | {{this.transformation}} | {{this.reason}} | `{{this.source}}` |
{{/each}}
{{else}}
| Transformation Type | Source Type | Target Type | Logic |
|---------------------|-------------|-------------|-------|
| BOOLEAN → NUMBER | boolean | NUMBER(1) | TRUE→1, FALSE→0 |
| ARRAY → VARCHAR | array[] | VARCHAR2/CLOB | array_to_string() |
| JSONB → CLOB | jsonb | CLOB | Direct JSON text |
| SERIAL → SEQUENCE | SERIAL | NUMBER | Create sequence + trigger |

> Transformation requirements need data analysis.
{{/if}}

### 9.3 Migration Order

**Source:** Foreign key dependency analysis

{{#if strategy.migration_order}}
| Phase | Tables | Dependencies | Rationale | Source |
|-------|--------|--------------|-----------|--------|
{{#each strategy.migration_order}}
| {{this.phase}} | {{this.tables}} | {{this.dependencies}} | {{this.rationale}} | `{{this.source}}` |
{{/each}}
{{else}}
> **Not found in source:** Migration order requires FK dependency graph analysis.
{{/if}}

---

## 10. Risk Assessment from Source

### 10.1 Technical Risks

**Source:** Feature and complexity analysis

{{#if strategy.risks}}
| Risk | Severity | Source Evidence | Mitigation |
|------|----------|-----------------|------------|
{{#each strategy.risks}}
| {{this.risk}} | {{this.severity}} | `{{this.source}}` | {{this.mitigation}} |
{{/each}}
{{else}}
| Risk Category | Count | Severity |
|---------------|-------|----------|
| PostgreSQL-specific types | {{metadata.pgSpecificTypeCount}} | {{metadata.pgTypeSeverity}} |
| Native SQL queries | {{metadata.source_analysis.nativeQueryCount}} | Medium |
| PL/pgSQL functions | {{metadata.source_analysis.database.functions}} | {{metadata.plpgsqlSeverity}} |
| Extensions | {{metadata.source_analysis.extensionCount}} | {{metadata.extensionSeverity}} |

> Risk assessment requires complete source analysis.
{{/if}}

### 10.2 High-Risk Components

**Source:** Complexity scoring

{{#if strategy.high_risk_components}}
| Component | Type | Complexity | Risk Factors | Source |
|-----------|------|------------|--------------|--------|
{{#each strategy.high_risk_components}}
| {{this.name}} | {{this.type}} | {{this.complexity}} | {{this.factors}} | `{{this.source}}` |
{{/each}}
{{else}}
> **Not found in source:** High-risk component identification requires analysis.
{{/if}}

---

## 11. Success Criteria

### 11.1 Technical Success Criteria

**Source:** Migration scope inventory

| Criteria | Target | Measurement | Source Baseline |
|----------|--------|-------------|-----------------|
| Tables migrated | {{metadata.source_analysis.database.tables}} | Row count validation | pg_tables catalog |
| Views migrated | {{metadata.source_analysis.database.views}} | Query result validation | pg_views catalog |
| Functions converted | {{metadata.source_analysis.database.functions}} | Unit test pass rate | pg_proc catalog |
| Queries rewritten | {{metadata.source_analysis.nativeQueryCount}} | Integration test pass | @Query extraction |
| Data integrity | 100% | Checksum validation | Source data |
| Performance | ≤ Baseline | Query timing comparison | Performance baseline |

---

## Appendices

### Appendix A: Type Mapping Reference

{{#if appendix.type_mapping}}
| PostgreSQL Type | Oracle Type | Conversion Notes |
|-----------------|-------------|------------------|
{{#each appendix.type_mapping}}
| {{this.pgType}} | {{this.oracleType}} | {{this.notes}} |
{{/each}}
{{/if}}

### Appendix B: SQL Function Mapping

{{#if appendix.function_mapping}}
| PostgreSQL Function | Oracle Function | Notes |
|---------------------|-----------------|-------|
{{#each appendix.function_mapping}}
| {{this.pgFunction}} | {{this.oracleFunction}} | {{this.notes}} |
{{/each}}
{{/if}}

---

## Traceability Note

All strategy decisions in this document are derived from PostgreSQL source analysis (DDL, catalogs, application code). Each recommendation includes source evidence. Items marked "Not found in source" require manual analysis.

---

## Document History

| Version | Date | Author | Changes |
|---------|------|--------|---------|
| {{version}} | {{generated_date}} | {{author}} | Auto-generated from source analysis |

---

**End of Migration Strategy Document**
